
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Request Center</title>
    <link rel="stylesheet" href="nav-bar2.css">
    <link rel="shortcut icon" href="images/logo.png" type="image/x-icon">
    <link rel="stylesheet" href="responsive.css">
    <style>#user-requests-pagination button {
    background: #d4af37;
    color: white;
    border: none;
    border-radius: 6px;
    padding: 5px 10px;
    margin: 0 2px;
    font-size: 16px;
    cursor: pointer;
    transition: background 0.2s;
}
#user-requests-pagination button.active,
#user-requests-pagination button:hover {
    background: #b5952a;
    font-weight: bold;
}
</style>
</head>
<body>
    <nav class="nav-bar-unique">
        <div class="logo-unique">
            <img src="images/logo.png" alt="Logo">
        </div>
        <ul class="nav-links-unique">
            <li><a href="dashboard.html">Home</a></li>
            <li><a href="pos.html">POS</a></li>
            <li><a href="PDC.html">Pediatric Dose Calculator</a></li>
            <li><a href="cross selling.html">Cross-selling Help</a></li>
            <li>
                <a href="#">Reports</a>
                <ul class="dropdown-unique">
                    <li><a href="sales report.html">Sales Report</a></li>
                    <li><a href="item-wise sale report.html">Item-wise Sales Report</a></li>

<li><a href="near-expiry-report.html">Near Expiry Report</a></li>
<li><a href="stock-report.html">Stock Report</a></li>

                </ul>
            </li>
            <li>
                <a href="#">Pharmacists’ Tools</a>
                <ul class="dropdown-unique">
                    <li><a href="requirements.html">Stock Requirements</a></li>
                    <li><a href="variations.html">Stock Variations</a></li>
                    <li><a href="testing.html">Blood Pressure and Sugar Check</a></li>
                    <li><a href="request-center-usrZ3v.html">Requests to Admin</a></li>
                </ul>
            </li>
            <li>
                <a href="#">Admin Tools</a>
                <ul class="dropdown-unique">
                    <li><a href="edit medicines.html">Edit Medicines List</a></li>
                    <li><a href="edit bills.html">Edit Bills</a></li>
                    <li><a href="user management.html">Edit Users</a></li>
                    <li><a href="admin-approvals.html">Review Requests</a></li>
                </ul>
            </li>
        </ul>
        <div class="search-unique">
            <input type="text" placeholder="Search...">
            <button>Search</button>
        </div>
    </nav>
    <div class="user-info">
        <div class="user-details">
          <span id="job-title">Pharmacist</span> <span id="pharmacist-name">MOHAMED</span> is logged-in
        </div>
        <div class="profile-pic">
            <img id="user-photo" src="" alt="Profile">
        </div>
        <button id="logout-btn" class="logout-btn" onclick="logout()">Log-out</button>
      </div>

    <main class="form-container">
        <h1 class="form-title">Submit a New Request</h1>
        <div class="request-links">
            <a href="request-expense.html" class="reqLink_expRq9x">Submit Expense Request</a>
            <a href="request-maintenance.html" class="reqLink_mntRq5h">Submit Maintenance Request</a>
            <a href="request-stock-edit.html" class="reqLink_stkEdv9t">Submit Stock Edit Request</a>
        </div>

        <h1 class="form-title" style="margin-top:50px;">Your Request Summary</h1>
        <div class="cards-summary">
            <div class="card-summary" id="usrDash9z_totalRequests">
                <div class="card-number">0</div>
                <div class="card-label">Requests Sent</div>
            </div>
            <div class="card-summary" id="usrDash9z_pending">
                <div class="card-number">0</div>
                <div class="card-label">Pending Requests</div>
            </div>
            <div class="card-summary" id="usrDash9z_approved">
                <div class="card-number">0</div>
                <div class="card-label">Approved Requests</div>
            </div>
            <div class="card-summary" id="usrDash9z_rejected">
                <div class="card-number">0</div>
                <div class="card-label">Rejected Requests</div>
            </div>
            <div class="card-summary" id="usrDash9z_usersInvolved">
                <div class="card-number">0</div>
                <div class="card-label">Users/Admins Involved</div>
            </div>
        </div>
        <h2 class="form-title" style="margin-top:30px;">Requests History</h2>
<div id="user-requests-table-container">
    <table id="user-requests-table" style="width:100%; margin-bottom:10px; background:white; border-radius:10px;">
        <thead>
            <tr>
                <th>ID</th>
                <th>Type</th>
                <th>Details</th>
                <th>Status</th>
                <th>Created At</th>
            </tr>
        </thead>
        <tbody>
            <!-- Populated by JS -->
        </tbody>
    </table>
    <div id="user-requests-pagination" style="text-align:center; margin-bottom:20px;">
        <!-- Pagination controls here -->
    </div>
</div>

    </main>

    <div class="dashboard-footer">
        © 2025 Pharmacy Management System | Designed by Pharmacist: MOHAMED HAMID |
        <a href="mailto:mhm.hamid@gmail.com">mhm.hamid@gmail.com</a> | All Rights Reserved
    </div>

    <style>
    .form-container {
        margin: 40px auto;
        max-width: 800px;
        padding: 20px;
        background-color: #f0f0f0;
        border-radius: 8px;
    }
    .form-title {
        text-align: center;
        color: black;
        margin-bottom: 20px;
    }
    .request-links {
        display: flex;
        flex-direction: column;
        gap: 15px;
    }
    .request-links a {
        background-color: #d4af37;
        color: white;
        padding: 12px;
        border-radius: 8px;
        text-decoration: none;
        text-align: center;
        font-size: 18px;
        transition: background-color 0.3s;
    }
    .request-links a:hover {
        background-color: darkgoldenrod;
    }
    .cards-summary {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
        gap: 15px;
        margin-top: 20px;
    }
    .card-summary {
        background-color: lightgray;
        border-radius: 10px;
        padding: 20px;
        text-align: center;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    }
    .card-number {
        font-size: 28px;
        font-weight: bold;
        color: #d4af37;
    }
    .card-label {
        margin-top: 5px;
        font-size: 14px;
        color: black;
    }
    #user-photo {
    width: 60px;
    height: 60px;
    border-radius: 50%; /* makes it a circle */
    object-fit: cover;  /* crop and center the image nicely */
    object-position: center; /* focus center of image */
    display: block;
}
    </style>



</body>
<script src="request-center9x.js"></script>
<script>//user info section
    document.addEventListener('DOMContentLoaded', () => {
      const userInfoString = sessionStorage.getItem('userInfo');
      if (!userInfoString) {
        console.log('No userInfo found in session storage, redirecting to login page');
        window.location.href = 'index.html';
        return;
      }
    
      try {
        const userInfo = JSON.parse(userInfoString);
        console.log('Parsed userInfo:', userInfo);
        
        // Update user profile information in the header
        document.getElementById('pharmacist-name').textContent = userInfo.fullName || userInfo.username;
        document.getElementById('job-title').textContent = userInfo.jobTitle || 'Staff';
        document.getElementById('user-photo').src = '/api/user-photo/' + userInfo.userId;
        
        // Optional: You could also add the user's avatar if available
        // const avatarContainer = document.querySelector('.profile-pic img');
        // if (userInfo.avatar) {
        //   avatarContainer.src = userInfo.avatar;
        // }
      } catch (error) {
        console.error('Error parsing user information:', error);
        alert('There was an error loading your profile. Please log in again.');
        window.location.href = 'index.html';
      }
    });
    
    //logout button
    function logout() {
      // Redirect to the login page or perform any other log-out action
      window.location.href = 'index.html'; // Assuming you have a login page named index.html
    }// ========== PAGINATED USER REQUESTS ==========

function loadUserRequestsPaginated(page = 1, limit = 10) {
    sendRequest9x('GET', `/api/my-requests-paginated?page=${page}&limit=${limit}`, null, function(status, result) {
        const tbody = document.getElementById('user-requests-table').querySelector('tbody');
        tbody.innerHTML = '';

        if (status !== 200 || !result || !result.data) {
            const tr = document.createElement('tr');
            tr.innerHTML = `<td colspan="5" style="text-align:center;color:red;">Failed to fetch requests.</td>`;
            tbody.appendChild(tr);
            return;
        }

        if (result.data.length) {
            result.data.forEach(req => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${req.id || ''}</td>
                    <td>${req.type || ''}</td>
                    <td>${req.details || req.reason || '-'}</td>
                    <td>${req.status || ''}</td>
                    <td>${req.created_at ? new Date(req.created_at).toLocaleString() : '-'}</td>
                `;
                tbody.appendChild(tr);
            });
        } else {
            const tr = document.createElement('tr');
            tr.innerHTML = `<td colspan="5" style="text-align:center;">No requests found.</td>`;
            tbody.appendChild(tr);
        }

        renderRequestsPagination(result.currentPage, result.totalPages);
    });
}

function renderRequestsPagination(current, total) {
    const container = document.getElementById('user-requests-pagination');
    container.innerHTML = '';

    if (total <= 1) return;

    for (let i = 1; i <= total; i++) {
        const btn = document.createElement('button');
        btn.textContent = i;
        btn.className = (i === current) ? 'active' : '';
        btn.style.margin = '0 4px';
        btn.onclick = () => loadUserRequestsPaginated(i);
        container.appendChild(btn);
    }
}

document.addEventListener('DOMContentLoaded', function() {
    if (window.location.pathname.includes('request-center-usrZ3v.html')) {
        setTimeout(() => loadUserRequestsPaginated(), 500);
    }
});</script>

</html>
